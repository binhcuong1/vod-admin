<style>
    #Country_id,
    #Country_id option {
        color: #212529 !important;
        background-color: #ffffff !important;
    }
</style>

<!-- movies.html (FINAL, clean + fully closed) -->
<h1 class="h3 mb-4 text-gray-800">Quản lý phim</h1>

<div class="card shadow mb-4">
    <div class="card-header py-3 d-flex justify-content-between align-items-center">
        <h6 class="m-0 font-weight-bold text-primary">Danh sách phim</h6>
        <div class="d-flex gap-2 align-items-center">
            <input id="movieSearch" class="form-control form-control-sm mr-2" placeholder="Tìm theo tên...">
            <button class="btn btn-sm btn-primary" id="btnAddMovie">
                <i class="fas fa-plus"></i> Thêm
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered" id="tblMovies" width="100%">
                <thead class="text-center">
                    <tr>
                        <th>ID</th>
                        <th>Tên phim</th>
                        <th>Năm</th>
                        <th>Thời lượng</th>
                        <th>Series?</th>
                        <th>Trạng thái</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal: Thêm/Sửa phim -->
<div class="modal fade" id="movieModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="movieForm">
                <div class="modal-header">
                    <h5 class="modal-title">Phim</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Đóng">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <input type="hidden" id="Movie_id">

                    <!-- Row 1: Tên phim + Năm -->
                    <div class="form-row">
                        <div class="form-group col-lg-8">
                            <label for="Movie_name">Tên phim</label>
                            <input class="form-control" id="Movie_name" required>
                        </div>
                        <div class="form-group col-lg-4">
                            <label for="Release_year">Năm phát hành</label>
                            <input type="number" min="1900" max="2100" class="form-control" id="Release_year">
                        </div>
                    </div>

                    <!-- Row 2: Tên gốc + Thời lượng -->
                    <div class="form-row">
                        <div class="form-group col-lg-8">
                            <label for="Original_name">Tên gốc</label>
                            <input class="form-control" id="Original_name">
                        </div>
                        <div class="form-group col-lg-4">
                            <label for="Duration">Thời lượng (phút)</label>
                            <input type="number" min="1" class="form-control" id="Duration">
                        </div>
                    </div>

                    <!-- Row 3: Mô tả -->
                    <div class="form-row">
                        <div class="form-group col-lg-12">
                            <label for="Overview">Mô tả / Tóm tắt</label>
                            <textarea class="form-control" id="Overview" rows="3"
                                placeholder="Tóm tắt nội dung..."></textarea>
                        </div>
                    </div>

                    <!-- Row 4: Quốc gia + Độ tuổi -->
                    <div class="form-row">
                        <div class="form-group col-lg-6">
                            <label for="Country_id">Quốc gia</label>
                            <select id="Country_id" class="form-control bg-white text-dark"></select>
                        </div>
                        <div class="form-group col-lg-6">
                            <label for="Maturity_rating">Giới hạn độ tuổi</label>
                            <select id="Maturity_rating" class="form-control">
                                <option value="">— Chọn —</option>
                                <option value="G">G</option>
                                <option value="PG">PG</option>
                                <option value="PG-13">PG-13</option>
                                <option value="R">R</option>
                                <option value="NC-17">NC-17</option>
                                <option value="16+">16+</option>
                                <option value="18+">18+</option>
                            </select>
                        </div>
                    </div>

                    <!-- Row 4.5: Thể loại + Diễn viên (nhiều lựa chọn) -->
                    <div class="form-row">
                        <!-- Thể loại: checkbox list + selected chips -->
                        <div class="form-group" id="GenresGroup">
                            <label>Thể loại</label>
                            <div id="Genre_list" class="border rounded p-2" style="max-height:220px; overflow:auto;">
                            </div>
                            <div class="mt-2">
                                <small class="text-muted">Đã chọn:</small>
                                <div id="Genre_selected" class="d-flex flex-wrap" style="gap:.25rem;"></div>
                            </div>
                        </div>
                        <!-- Diễn viên: search + checkbox list + selected chips -->
                        <div class="form-group col-lg-6" id="ActorsGroup">
                            <label>Diễn viên</label>

                            <!-- search box -->
                            <div class="input-group mb-2">
                                <input id="Actor_search" class="form-control form-control-sm"
                                    placeholder="Tìm diễn viên...">
                                <div class="input-group-append">
                                    <button type="button" class="btn btn-sm btn-outline-secondary"
                                        id="Actor_clear">Xoá</button>
                                </div>
                            </div>

                            <!-- danh sách checkbox -->
                            <div id="Actor_list" class="border rounded p-2" style="max-height:220px; overflow:auto;">
                            </div>

                            <!-- chips các diễn viên đã chọn -->
                            <div class="mt-2">
                                <small class="text-muted">Đã chọn:</small>
                                <div id="Actor_selected" class="d-flex flex-wrap" style="gap:.25rem;"></div>
                            </div>
                        </div>

                    </div>

                    <!-- Row 5: Trạng thái + Trailer -->
                    <div class="form-row">
                        <div class="form-group col-lg-6">
                            <label for="Film_status">Trạng thái phim</label>
                            <select id="Film_status" class="form-control">
                                <option value="">— Chọn —</option>
                                <option value="đang chiếu">Đang chiếu</option>
                                <option value="hoàn thành">Hoàn thành</option>
                                <option value="sắp chiếu">Sắp chiếu</option>
                            </select>
                        </div>
                        <div class="form-group col-lg-6">
                            <label for="Trailer_url">Trailer URL (YouTube)</label>
                            <input class="form-control" id="Trailer_url" placeholder="https://youtu.be/...">
                        </div>
                    </div>

                    <!-- Row 6: Checkbox -->
                    <div class="form-row">
                        <div class="form-group col-lg-3">
                            <div class="form-check mt-1">
                                <input class="form-check-input" type="checkbox" id="Is_series">
                                <label class="form-check-label" for="Is_series">Là series</label>
                            </div>
                        </div>
                        <div class="form-group col-lg-3">
                            <div class="form-check mt-1">
                                <input class="form-check-input" type="checkbox" id="Is_active" checked>
                                <label class="form-check-label" for="Is_active">Đang hoạt động</label>
                            </div>
                        </div>
                        <div id="seriesAddNote" class="alert alert-warning py-2 px-3 small d-none">
                            Bạn đã chọn <strong>Là series</strong>. Hãy <strong>Lưu</strong> phim trước,
                            sau đó vào <strong>Sửa phim</strong> để cài đặt <em>Seasons &amp; Episodes</em>.
                        </div>
                    </div>

                    <!-- Movie-level Sources (chỉ hiện khi KHÔNG tick Là series) -->
                    <div id="movieSourcesBlock" class="mt-3" style="display:none">
                        <hr>
                        <div class="d-flex align-items-center justify-content-between">
                            <h6 class="mb-0">Nguồn phát (Movie)</h6>
                            <button type="button" class="btn btn-sm btn-outline-primary" id="btnSaveMovieSources">
                                Lưu nguồn phát
                            </button>
                        </div>

                        <div class="table-responsive mt-2">
                            <table class="table table-sm table-bordered mb-0">
                                <thead class="text-center">
                                    <tr>
                                        <th style="width:120px">Resolution</th>
                                        <th>URL</th>
                                    </tr>
                                </thead>
                                <tbody id="movieSourceBody">
                                    <!-- sẽ render 360p/480p/720p/1080p (và/hoặc từ API resolutions) -->
                                </tbody>
                            </table>
                        </div>
                        <small class="text-muted">Để trống ô URL nếu không có nguồn ở độ phân giải đó.</small>
                    </div>

                    <!-- Nút Hủy / Lưu (chỉ áp dụng cho thông tin phim) -->
                    <div class="d-flex justify-content-end mt-3 mb-2">
                        <button class="btn btn-secondary mr-2" type="button" data-dismiss="modal">
                            Hủy
                        </button>
                        <button class="btn btn-primary" id="btnSaveMovie" type="submit">
                            Lưu
                        </button>
                    </div>

                    <!-- (Tùy chọn) Series Block -->
                    <div id="seriesBlock" class="mt-3" style="display:none">
                        <hr>
                        <div class="d-flex align-items-center justify-content-between">
                            <h6 class="mb-0">Seasons &amp; Episodes</h6>
                            <button type="button" class="btn btn-sm btn-outline-primary" id="btnAddSeason">
                                <i class="fas fa-layer-group"></i> Thêm mùa
                            </button>
                        </div>

                        <!-- Accordion chứa các mùa -->
                        <div id="seasonAccordion" class="mt-2">
                            <!-- JS sẽ render từng mùa + các tập bên trong -->
                        </div>
                    </div>

                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Đóng</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Xem chi tiết phim -->
<div class="modal fade" id="movieDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Chi tiết phim: <span id="mvDtlTitle" class="text-primary"></span>
                    <small class="ml-2 badge badge-info" id="mvDtlType"></small>
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Đóng">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <!-- Hàng 1: Poster + Thông tin cơ bản -->
                <div class="row">
                    <div class="col-md-3">
                        <div id="mvDtlPosters" class="d-flex flex-column gap-2"></div>
                    </div>
                    <div class="col-md-9">
                        <div class="row">
                            <div class="col-sm-6">
                                <div><strong>Tên gốc:</strong> <span id="mvDtlOriginal"></span></div>
                                <div><strong>Năm:</strong> <span id="mvDtlYear"></span></div>
                                <div><strong>Thời lượng:</strong> <span id="mvDtlDuration"></span></div>
                                <div><strong>Độ tuổi:</strong> <span id="mvDtlRating"></span></div>
                            </div>
                            <div class="col-sm-6">
                                <div><strong>Quốc gia:</strong> <span id="mvDtlCountry"></span></div>
                                <div><strong>Trạng thái:</strong> <span id="mvDtlStatus"
                                        class="badge badge-secondary"></span></div>
                                <div><strong>Trailer:</strong> <a id="mvDtlTrailer" target="_blank"
                                        rel="noopener">Xem</a></div>
                            </div>
                        </div>
                        <hr>
                        <div>
                            <strong>Mô tả:</strong>
                            <div id="mvDtlDesc" class="mt-1"></div>
                        </div>
                    </div>
                </div>

                <hr>

                <!-- Hàng 2: Thể loại + Nguồn phim -->
                <div class="row">
                    <div class="col-md-6">
                        <h6>Thể loại</h6>
                        <div id="mvDtlGenres" class="d-flex flex-wrap gap-1"></div>
                    </div>
                    <div class="col-md-6" id="mvDtlSourcesCol">
                        <h6>Nguồn phát (Movie)</h6>
                        <div id="mvDtlSources" class="table-responsive">
                            <table class="table table-sm table-bordered mb-0">
                                <thead class="text-center">
                                    <tr>
                                        <th>Resolution</th>
                                        <th>URL</th>
                                    </tr>
                                </thead>
                                <tbody id="mvDtlSourceBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>


                <hr>

                <!-- Hàng 3: Diễn viên -->
                <div>
                    <h6>Diễn viên</h6>
                    <div id="mvDtlCast" class="d-flex flex-wrap gap-2"></div>
                </div>

                <!-- Hàng 4 (nếu là series): Seasons/Episodes -->
                <div id="mvDtlSeries" style="display:none">
                    <hr>
                    <h6>Seasons &amp; Episodes</h6>
                    <div id="mvDtlSeasons"></div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Sửa nguồn phát của 1 tập -->
<div class="modal fade" id="epSourceModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header py-2">
                <h6 class="modal-title">Nguồn phát tập <span id="epSourceTitle" class="text-primary"></span></h6>
                <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
            </div>
            <div class="modal-body">
                <table class="table table-sm table-bordered mb-2">
                    <thead class="text-center">
                        <tr>
                            <th style="width:120px">Resolution</th>
                            <th>URL</th>
                        </tr>
                    </thead>
                    <tbody id="epSourceBody"></tbody>
                </table>
                <small class="text-muted">Để trống ô URL nếu không có nguồn ở độ phân giải đó.</small>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button class="btn btn-primary" id="btnSaveEpSources">Lưu</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Thêm mùa -->
<div class="modal fade" id="seasonAddModal" tabindex="-1" role="dialog" aria-labelledby="seasonAddLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header py-2">
                <h6 class="modal-title" id="seasonAddLabel">Thêm mùa</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body py-2">
                <div class="form-group mb-2">
                    <label for="seasonNameInput" class="mb-1">Tên mùa</label>
                    <input type="text" class="form-control form-control-sm" id="seasonNameInput"
                        placeholder="Mùa 1 / Season 1">
                </div>
            </div>
            <div class="modal-footer py-2">
                <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-sm btn-primary" id="btnSeasonSave">Lưu</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Sửa tập -->
<div class="modal fade" id="episodeEditModal" tabindex="-1" role="dialog" aria-labelledby="episodeEditLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header py-2">
                <h6 class="modal-title" id="episodeEditLabel">Sửa tập</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body py-2">
                <input type="hidden" id="epEditId">
                <input type="hidden" id="epEditSeasonId">
                <div class="form-group mb-2">
                    <label for="epTitleInput" class="mb-1">Tên tập</label>
                    <input type="text" class="form-control form-control-sm" id="epTitleInput">
                </div>
                <div class="form-group mb-1">
                    <label for="epDurationInput" class="mb-1">Thời lượng (phút)</label>
                    <input type="number" min="0" class="form-control form-control-sm" id="epDurationInput">
                </div>
            </div>
            <div class="modal-footer py-2">
                <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-sm btn-primary" id="btnEpEditSave">Lưu</button>
            </div>
        </div>
    </div>
</div>